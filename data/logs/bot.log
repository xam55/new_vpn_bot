2025-12-26 02:58:57,741 - __main__ - INFO - База данных создана
2025-12-26 02:59:05,115 - __main__ - CRITICAL - Критическая ошибка: cannot import name 'get_user_keys_keyboard' from 'src.keyboards' (C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\keyboards\__init__.py)
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\main.py", line 8, in <module>
    from src.bot.loader import setup_middlewares, setup_routers
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\loader.py", line 6, in <module>
    from src.handlers import start_router, vpn_key_router, admin_router
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\__init__.py", line 4, in <module>
    from .status import router as status_router
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\status.py", line 8, in <module>
    from src.keyboards import (
ImportError: cannot import name 'get_user_keys_keyboard' from 'src.keyboards' (C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\keyboards\__init__.py)
2025-12-26 02:59:19,804 - __main__ - INFO - База данных создана
2025-12-26 02:59:27,153 - __main__ - CRITICAL - Критическая ошибка: cannot import name 'format_key_info' from 'src.utils.formatters' (C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\utils\formatters.py)
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\main.py", line 8, in <module>
    from src.bot.loader import setup_middlewares, setup_routers
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\loader.py", line 6, in <module>
    from src.handlers import start_router, vpn_key_router, admin_router
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\__init__.py", line 4, in <module>
    from .status import router as status_router
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\status.py", line 14, in <module>
    from src.utils.formatters import format_key_info, format_time_left
ImportError: cannot import name 'format_key_info' from 'src.utils.formatters' (C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\utils\formatters.py)
2025-12-26 02:59:42,788 - __main__ - INFO - База данных создана
2025-12-26 02:59:51,388 - __main__ - CRITICAL - Критическая ошибка: Passing `parse_mode`, `disable_web_page_preview` or `protect_content` to Bot initializer is not supported anymore. These arguments have been removed in 3.7.0 version. Use `default=DefaultBotProperties(parse_mode=<ParseMode.HTML: 'HTML'>)` argument instead.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\run.py", line 73, in main
    await bot_main()
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\main.py", line 20, in main
    bot = Bot(
          ^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\client\bot.py", line 301, in __init__
    raise TypeError(
TypeError: Passing `parse_mode`, `disable_web_page_preview` or `protect_content` to Bot initializer is not supported anymore. These arguments have been removed in 3.7.0 version. Use `default=DefaultBotProperties(parse_mode=<ParseMode.HTML: 'HTML'>)` argument instead.
2025-12-26 03:00:02,787 - __main__ - INFO - База данных создана
2025-12-26 03:00:11,447 - __main__ - CRITICAL - Критическая ошибка: name 'status_router' is not defined
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\run.py", line 73, in main
    await bot_main()
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\main.py", line 34, in main
    routers = setup_routers()
              ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\loader.py", line 19, in setup_routers
    routers.append(status_router)
                   ^^^^^^^^^^^^^
NameError: name 'status_router' is not defined
2025-12-26 03:00:27,589 - __main__ - INFO - База данных создана
2025-12-26 03:00:35,777 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 03:00:35,778 - vpn_bot - INFO - Бот запускается...
2025-12-26 03:00:36,033 - aiogram.event - ERROR - Cause exception while process update id=385075177 by bot id=8399571083
NameError: name 'get_session' is not defined
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 19, in cmd_start
    async for session in get_session():
                         ^^^^^^^^^^^
NameError: name 'get_session' is not defined
2025-12-26 03:01:06,535 - aiogram.event - ERROR - Cause exception while process update id=385075178 by bot id=8399571083
NameError: name 'get_session' is not defined
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 28, in cmd_vpn_key
    async for session in get_session():
                         ^^^^^^^^^^^
NameError: name 'get_session' is not defined
2025-12-26 03:01:10,917 - aiogram.event - ERROR - Cause exception while process update id=385075179 by bot id=8399571083
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2531, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'vpn_keys'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\status.py", line 28, in cmd_my_status
    user = await UserDAO.get_by_telegram_id(session, message.from_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 30, in get_by_telegram_id
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 595, in init
    self.do_init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1660, in do_init
    self._generate_backref()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2144, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1591, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2533, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:01:15,743 - aiogram.event - ERROR - Cause exception while process update id=385075184 by bot id=8399571083
ImportError: cannot import name 'PaymentDAO' from 'src.services.database' (C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\database.py)
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\admin\panel.py", line 66, in show_confirmations
    from src.services.database import PaymentDAO, get_session
ImportError: cannot import name 'PaymentDAO' from 'src.services.database' (C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\database.py)
2025-12-26 03:01:17,482 - aiogram.event - ERROR - Cause exception while process update id=385075185 by bot id=8399571083
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\admin\panel.py", line 37, in back_to_main_menu
    await callback.message.edit_text(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-12-26 03:01:25,081 - aiogram.event - ERROR - Cause exception while process update id=385075186 by bot id=8399571083
NameError: name 'get_session' is not defined
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 19, in cmd_start
    # Регистрируем пользователя
                ^^^^^^
NameError: name 'get_session' is not defined
2025-12-26 03:04:36,786 - __main__ - INFO - База данных создана
2025-12-26 03:04:45,511 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 03:04:45,512 - vpn_bot - INFO - Бот запускается...
2025-12-26 03:04:49,370 - aiogram.event - ERROR - Cause exception while process update id=385075187 by bot id=8399571083
NameError: name 'get_session' is not defined
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 28, in cmd_vpn_key
    async for session in get_session():
                         ^^^^^^^^^^^
NameError: name 'get_session' is not defined
2025-12-26 03:04:54,270 - aiogram.event - ERROR - Cause exception while process update id=385075188 by bot id=8399571083
NameError: name 'get_session' is not defined
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 28, in cmd_vpn_key
    async for session in get_session():
                         ^^^^^^^^^^^
NameError: name 'get_session' is not defined
2025-12-26 03:04:57,848 - aiogram.event - ERROR - Cause exception while process update id=385075190 by bot id=8399571083
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2531, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'vpn_keys'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\status.py", line 28, in cmd_my_status
    user = await UserDAO.get_by_telegram_id(session, message.from_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 30, in get_by_telegram_id
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 595, in init
    self.do_init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1660, in do_init
    self._generate_backref()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2144, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1591, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2533, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:05:02,874 - aiogram.event - ERROR - Cause exception while process update id=385075191 by bot id=8399571083
ImportError: cannot import name 'PaymentDAO' from 'src.services.database' (C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\database.py)
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\admin\panel.py", line 66, in show_confirmations
    from src.services.database import PaymentDAO, get_session
ImportError: cannot import name 'PaymentDAO' from 'src.services.database' (C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\database.py)
2025-12-26 03:09:36,076 - __main__ - INFO - База данных создана
2025-12-26 03:09:45,073 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 03:09:45,074 - vpn_bot - INFO - Бот запускается...
2025-12-26 03:09:45,325 - aiogram.event - ERROR - Cause exception while process update id=385075196 by bot id=8399571083
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2531, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'vpn_keys'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 595, in init
    self.do_init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1660, in do_init
    self._generate_backref()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2144, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1591, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2533, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:09:45,364 - aiogram.event - ERROR - Cause exception while process update id=385075195 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[VPNKey(vpn_keys)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\status.py", line 28, in cmd_my_status
    user = await UserDAO.get_by_telegram_id(session, message.from_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 30, in get_by_telegram_id
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[VPNKey(vpn_keys)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:09:48,764 - aiogram.event - ERROR - Cause exception while process update id=385075197 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[VPNKey(vpn_keys)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[VPNKey(vpn_keys)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:10:07,200 - aiogram.event - ERROR - Cause exception while process update id=385075198 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[VPNKey(vpn_keys)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[VPNKey(vpn_keys)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'vpn_keys'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:17:37,959 - __main__ - INFO - База данных создана
2025-12-26 03:17:46,215 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 03:17:46,217 - vpn_bot - INFO - Бот запускается...
2025-12-26 03:18:19,494 - aiogram.event - ERROR - Cause exception while process update id=385075200 by bot id=8399571083
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2531, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'payments'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 31, in cmd_vpn_key
    user = await UserDAO.get_by_telegram_id(session, message.from_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 30, in get_by_telegram_id
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 595, in init
    self.do_init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1660, in do_init
    self._generate_backref()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2144, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1591, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2533, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:21:23,151 - __main__ - INFO - База данных создана
2025-12-26 03:21:30,401 - __main__ - CRITICAL - Критическая ошибка: name 'purchase_router' is not defined
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\main.py", line 9, in <module>
    from src.bot.loader import setup_middlewares, setup_routers
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\loader.py", line 8, in <module>
    from src.handlers.vpn_key import vpn_key_router
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\__init__.py", line 9, in <module>
    vpn_key_router.include_router(purchase_router)
                                  ^^^^^^^^^^^^^^^
NameError: name 'purchase_router' is not defined
2025-12-26 03:21:42,908 - __main__ - INFO - База данных создана
2025-12-26 03:21:51,141 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 03:21:51,143 - vpn_bot - INFO - Бот запускается...
2025-12-26 03:21:54,346 - aiogram.event - ERROR - Cause exception while process update id=385075201 by bot id=8399571083
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2531, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'payments'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 31, in cmd_vpn_key
    user = await UserDAO.get_by_telegram_id(session, message.from_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 30, in get_by_telegram_id
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 595, in init
    self.do_init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1660, in do_init
    self._generate_backref()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2144, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1591, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2533, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:22:15,725 - aiogram.event - ERROR - Cause exception while process update id=385075202 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:29:07,445 - __main__ - INFO - База данных создана
2025-12-26 03:29:16,536 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 03:29:16,537 - vpn_bot - INFO - Бот запускается...
2025-12-26 03:29:19,526 - aiogram.event - ERROR - Cause exception while process update id=385075203 by bot id=8399571083
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2531, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'payments'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 595, in init
    self.do_init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1660, in do_init
    self._generate_backref()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2144, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1591, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2533, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:29:32,269 - aiogram.event - ERROR - Cause exception while process update id=385075204 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:29:45,870 - aiogram.event - ERROR - Cause exception while process update id=385075205 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 31, in cmd_vpn_key
    user = await UserDAO.get_by_telegram_id(session, message.from_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 30, in get_by_telegram_id
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:29:48,477 - aiogram.event - ERROR - Cause exception while process update id=385075206 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:30:04,150 - aiogram.event - ERROR - Cause exception while process update id=385075207 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:31:23,757 - __main__ - INFO - База данных создана
2025-12-26 03:31:32,549 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 03:31:32,550 - vpn_bot - INFO - Бот запускается...
2025-12-26 03:31:32,802 - aiogram.event - ERROR - Cause exception while process update id=385075208 by bot id=8399571083
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2531, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'payments'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 595, in init
    self.do_init()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1660, in do_init
    self._generate_backref()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2144, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1591, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2533, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:32:00,281 - aiogram.event - ERROR - Cause exception while process update id=385075209 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:33:44,517 - aiogram.event - ERROR - Cause exception while process update id=385075210 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:33:55,745 - aiogram.event - ERROR - Cause exception while process update id=385075211 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:33:56,496 - aiogram.event - ERROR - Cause exception while process update id=385075212 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:34:01,727 - aiogram.event - ERROR - Cause exception while process update id=385075213 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\Desktop\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:34:57,801 - __main__ - ERROR - Ошибка БД: No module named 'aiosqlite'
2025-12-26 03:35:25,844 - __main__ - INFO - База данных создана
2025-12-26 03:35:25,847 - __main__ - CRITICAL - Критическая ошибка: No module named 'aiogram'
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\main.py", line 3, in <module>
    from aiogram import Bot, Dispatcher
ModuleNotFoundError: No module named 'aiogram'
2025-12-26 03:36:46,484 - __main__ - INFO - База данных создана
2025-12-26 03:36:50,632 - __main__ - CRITICAL - Критическая ошибка: No module named 'cachetools'
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\main.py", line 9, in <module>
    from src.bot.loader import setup_middlewares, setup_routers
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\loader.py", line 2, in <module>
    from src.bot.middlewares.throttling import ThrottlingMiddleware
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\__init__.py", line 1, in <module>
    from .throttling import ThrottlingMiddleware
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 4, in <module>
    from cachetools import TTLCache
ModuleNotFoundError: No module named 'cachetools'
2025-12-26 03:38:01,472 - __main__ - INFO - База данных создана
2025-12-26 03:38:05,219 - __main__ - CRITICAL - Критическая ошибка: No module named 'cachetools'
Traceback (most recent call last):
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\main.py", line 9, in <module>
    from src.bot.loader import setup_middlewares, setup_routers
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\loader.py", line 2, in <module>
    from src.bot.middlewares.throttling import ThrottlingMiddleware
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\__init__.py", line 1, in <module>
    from .throttling import ThrottlingMiddleware
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 4, in <module>
    from cachetools import TTLCache
ModuleNotFoundError: No module named 'cachetools'
2025-12-26 03:38:21,075 - __main__ - INFO - База данных создана
2025-12-26 03:38:25,897 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 03:38:25,898 - vpn_bot - INFO - Бот запускается...
2025-12-26 03:38:30,918 - aiogram.event - ERROR - Cause exception while process update id=385075214 by bot id=8399571083
InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2531, in get_property
    return self._props[key]
           ~~~~~~~~~~~^^^^^
KeyError: 'payments'

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4268, in _do_configure_registries
    mapper._post_configure_properties()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2427, in _post_configure_properties
    prop.init()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\interfaces.py", line 595, in init
    self.do_init()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1660, in do_init
    self._generate_backref()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 2144, in _generate_backref
    self._add_reverse_property(self.back_populates)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\relationships.py", line 1591, in _add_reverse_property
    other = self.mapper.get_property(key, _configure_mappers=False)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2533, in get_property
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:38:40,126 - aiogram.event - ERROR - Cause exception while process update id=385075215 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:38:43,246 - aiogram.event - ERROR - Cause exception while process update id=385075216 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:38:43,390 - aiogram.event - ERROR - Cause exception while process update id=385075217 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:38:43,539 - aiogram.event - ERROR - Cause exception while process update id=385075218 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:38:43,691 - aiogram.event - ERROR - Cause exception while process update id=385075219 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:38:44,006 - aiogram.event - ERROR - Cause exception while process update id=385075220 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:38:54,209 - aiogram.event - ERROR - Cause exception while process update id=385075221 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:39:03,921 - aiogram.event - ERROR - Cause exception while process update id=385075222 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 31, in cmd_vpn_key
    user = await UserDAO.get_by_telegram_id(session, message.from_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 30, in get_by_telegram_id
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 03:39:15,075 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 03:39:15,076 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 04:03:30,622 - __main__ - INFO - База данных создана
2025-12-26 04:03:37,117 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 04:03:37,118 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 04:03:37,118 - vpn_bot - INFO - Планировщик запущен
2025-12-26 04:03:37,118 - vpn_bot - INFO - Бот запускается...
2025-12-26 04:03:37,119 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 04:03:37,132 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:03:39,727 - aiogram.event - ERROR - Cause exception while process update id=385075223 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:03:58,451 - aiogram.event - ERROR - Cause exception while process update id=385075224 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:04:07,656 - aiogram.event - ERROR - Cause exception while process update id=385075225 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:04:17,749 - aiogram.event - ERROR - Cause exception while process update id=385075226 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 32, in cmd_vpn_key
    user = await UserDAO.get_by_telegram_id(session, message.from_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 30, in get_by_telegram_id
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:11:34,829 - __main__ - INFO - База данных создана
2025-12-26 04:11:40,176 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 04:11:40,177 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 04:11:40,177 - vpn_bot - INFO - Планировщик запущен
2025-12-26 04:11:40,178 - vpn_bot - INFO - Бот запускается...
2025-12-26 04:11:40,179 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 04:11:40,193 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:11:40,384 - aiogram.event - ERROR - Cause exception while process update id=385075227 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:11:43,670 - aiogram.event - ERROR - Cause exception while process update id=385075228 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:11:59,395 - aiogram.event - ERROR - Cause exception while process update id=385075229 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:12:05,963 - aiogram.event - ERROR - Cause exception while process update id=385075230 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:12:13,766 - aiogram.event - ERROR - Cause exception while process update id=385075231 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:14:37,734 - __main__ - INFO - База данных создана
2025-12-26 04:14:42,897 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 04:14:42,898 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 04:14:42,898 - vpn_bot - INFO - Планировщик запущен
2025-12-26 04:14:42,899 - vpn_bot - INFO - Бот запускается...
2025-12-26 04:14:42,901 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 04:14:42,916 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:14:43,099 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:14:43,100 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 04:14:47,215 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:14:47,215 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 04:14:48,349 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:14:48,351 - aiogram.dispatcher - WARNING - Sleep for 1.318548 seconds and try again... (tryings = 1, bot id = 8399571083)
2025-12-26 04:14:52,791 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:14:52,792 - aiogram.dispatcher - WARNING - Sleep for 1.160966 seconds and try again... (tryings = 1, bot id = 8399571083)
2025-12-26 04:14:54,057 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:14:54,058 - aiogram.dispatcher - WARNING - Sleep for 1.708048 seconds and try again... (tryings = 2, bot id = 8399571083)
2025-12-26 04:14:58,872 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:14:58,872 - aiogram.dispatcher - WARNING - Sleep for 1.441825 seconds and try again... (tryings = 2, bot id = 8399571083)
2025-12-26 04:15:00,413 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:00,414 - aiogram.dispatcher - WARNING - Sleep for 2.353559 seconds and try again... (tryings = 3, bot id = 8399571083)
2025-12-26 04:15:05,869 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:05,870 - aiogram.dispatcher - WARNING - Sleep for 1.728466 seconds and try again... (tryings = 3, bot id = 8399571083)
2025-12-26 04:15:07,707 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:07,708 - aiogram.dispatcher - WARNING - Sleep for 3.043166 seconds and try again... (tryings = 4, bot id = 8399571083)
2025-12-26 04:15:10,853 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:10,854 - aiogram.dispatcher - WARNING - Sleep for 2.116130 seconds and try again... (tryings = 4, bot id = 8399571083)
2025-12-26 04:15:16,077 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:16,078 - aiogram.dispatcher - WARNING - Sleep for 3.903283 seconds and try again... (tryings = 5, bot id = 8399571083)
2025-12-26 04:15:20,102 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:20,102 - aiogram.dispatcher - WARNING - Sleep for 2.708540 seconds and try again... (tryings = 5, bot id = 8399571083)
2025-12-26 04:15:25,063 - aiogram.event - ERROR - Cause exception while process update id=385075232 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:15:25,918 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:25,918 - aiogram.dispatcher - WARNING - Sleep for 5.050356 seconds and try again... (tryings = 6, bot id = 8399571083)
2025-12-26 04:15:29,266 - aiogram.event - ERROR - Cause exception while process update id=385075233 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:15:31,069 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:31,070 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 04:15:32,946 - aiogram.event - ERROR - Cause exception while process update id=385075234 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\Desktop\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 449, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 203, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2351, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2249, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 306, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 527, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1633, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 716, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 324, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1447, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 887, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 933, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 138, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4782, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 701, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 447, in create_for_statement
    return cls._create_orm_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1175, in _create_orm_context
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2628, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2708, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1338, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2733, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2410, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4227, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\hakaton_tovar\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4264, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 04:15:35,169 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:35,169 - aiogram.dispatcher - WARNING - Sleep for 5.010703 seconds and try again... (tryings = 7, bot id = 8399571083)
2025-12-26 04:15:40,287 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:40,288 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 04:15:44,434 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramConflictError: Telegram server says - Conflict: terminated by other getUpdates request; make sure that only one bot instance is running
2025-12-26 04:15:44,435 - aiogram.dispatcher - WARNING - Sleep for 4.961074 seconds and try again... (tryings = 8, bot id = 8399571083)
2025-12-26 04:15:44,811 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 04:15:44,812 - aiogram.dispatcher - WARNING - Sleep for 1.274252 seconds and try again... (tryings = 1, bot id = 8399571083)
2025-12-26 04:15:44,978 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 04:15:44,979 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 20:57:21,271 - __main__ - INFO - База данных создана
2025-12-26 20:57:24,545 - __main__ - CRITICAL - Критическая ошибка: No module named 'aiogram.client.default'
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\main.py", line 5, in <module>
    from aiogram.client.default import DefaultBotProperties
ModuleNotFoundError: No module named 'aiogram.client.default'
2025-12-26 21:01:26,529 - __main__ - INFO - База данных создана
2025-12-26 21:01:34,613 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 21:01:34,614 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 21:01:34,614 - vpn_bot - INFO - Планировщик запущен
2025-12-26 21:01:34,615 - vpn_bot - INFO - Бот запускается...
2025-12-26 21:01:34,615 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 21:01:34,631 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 21:02:31,481 - aiogram.event - ERROR - Cause exception while process update id=385075235 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\start.py", line 21, in cmd_start
    user = await UserDAO.get_or_create(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\services\dao.py", line 16, in get_or_create
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 192, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1631, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 704, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1426, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 867, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 912, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 143, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4590, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 687, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1091, in create_for_statement
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2537, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2617, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1260, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2707, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2386, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4199, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4236, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 21:02:43,692 - aiogram.event - ERROR - Cause exception while process update id=385075236 by bot id=8399571083
InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 32, in cmd_vpn_key
    user = await UserDAO.get_by_telegram_id(session, message.from_user.id)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\services\dao.py", line 30, in get_by_telegram_id
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 192, in greenlet_spawn
    result = context.switch(value)
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1631, in _execute_clauseelement
    compiled_sql, extracted_params, cache_hit = elem._compile_w_cache(
                                                ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 704, in _compile_w_cache
    compiled_sql = self._compiler(
                   ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 316, in _compiler
    return dialect.statement_compiler(dialect, self, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 1426, in __init__
    Compiled.__init__(self, dialect, statement, **kwargs)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 867, in __init__
    self.string = self.process(self.statement, **compile_kwargs)
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 912, in process
    return obj._compiler_dispatch(self, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\visitors.py", line 143, in _compiler_dispatch
    return meth(self, **kw)  # type: ignore  # noqa: E501
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\compiler.py", line 4590, in visit_select
    compile_state = select_stmt._compile_state_factory(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\base.py", line 687, in create_for_statement
    return klass.create_for_statement(statement, compiler, **kw)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 1091, in create_for_statement
    _QueryEntity.to_compile_state(
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2537, in to_compile_state
    _MapperEntity(
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 2617, in __init__
    entity._post_inspect
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 1260, in __get__
    obj.__dict__[self.__name__] = result = self.fget(obj)
                                           ^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2707, in _post_inspect
    self._check_configure()
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 2386, in _check_configure
    _configure_registries({self.registry}, cascade=True)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4199, in _configure_registries
    _do_configure_registries(registries, cascade)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\mapper.py", line 4236, in _do_configure_registries
    raise e
sqlalchemy.exc.InvalidRequestError: One or more mappers failed to initialize - can't proceed with initialization of other mappers. Triggering mapper: 'Mapper[Payment(payments)]'. Original exception was: Mapper 'Mapper[User(users)]' has no property 'payments'.  If this property was indicated from other mappers or configure events, ensure registry.configure() has been called.
2025-12-26 21:03:25,323 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 21:03:25,323 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 21:03:25,574 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 21:03:25,574 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 21:06:50,921 - __main__ - INFO - База данных создана
2025-12-26 21:06:57,711 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 21:06:57,712 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 21:06:57,713 - vpn_bot - INFO - Планировщик запущен
2025-12-26 21:06:57,714 - vpn_bot - INFO - Бот запускается...
2025-12-26 21:06:57,715 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 21:06:57,741 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.status = ? AND vpn_keys.expires_at < ?]
[parameters: ('active', '2025-12-26 21:06:57.716760')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-26 21:08:23,032 - aiogram.event - ERROR - Cause exception while process update id=385075242 by bot id=8399571083
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\payment.py", line 114, in mark_as_paid
    await callback.message.edit_text(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\types\message.py", line 3896, in edit_text
    return EditMessageText(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\pydantic\main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2025-12-26 21:08:32,827 - aiogram.event - ERROR - Cause exception while process update id=385075243 by bot id=8399571083
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\payment.py", line 133, in request_photo
    await callback.message.edit_text(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\types\message.py", line 3896, in edit_text
    return EditMessageText(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\pydantic\main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2025-12-26 21:08:35,404 - aiogram.event - ERROR - Cause exception while process update id=385075245 by bot id=8399571083
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\payment.py", line 114, in mark_as_paid
    await callback.message.edit_text(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\types\message.py", line 3896, in edit_text
    return EditMessageText(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\pydantic\main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2025-12-26 21:08:35,412 - aiogram.event - ERROR - Cause exception while process update id=385075244 by bot id=8399571083
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\payment.py", line 133, in request_photo
    await callback.message.edit_text(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\types\message.py", line 3896, in edit_text
    return EditMessageText(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\pydantic\main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2025-12-26 21:08:36,488 - aiogram.event - ERROR - Cause exception while process update id=385075246 by bot id=8399571083
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\payment.py", line 133, in request_photo
    await callback.message.edit_text(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\types\message.py", line 3896, in edit_text
    return EditMessageText(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\pydantic\main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2025-12-26 21:08:42,800 - aiogram.event - ERROR - Cause exception while process update id=385075247 by bot id=8399571083
ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\payment.py", line 114, in mark_as_paid
    await callback.message.edit_text(
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\types\message.py", line 3896, in edit_text
    return EditMessageText(
           ^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\pydantic\main.py", line 212, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pydantic_core._pydantic_core.ValidationError: 1 validation error for EditMessageText
reply_markup
  Input should be a valid dictionary or instance of InlineKeyboardMarkup [type=model_type, input_value=ReplyKeyboardMarkup(keybo...er=None, selective=None), input_type=ReplyKeyboardMarkup]
    For further information visit https://errors.pydantic.dev/2.9/v/model_type
2025-12-26 21:09:53,214 - aiogram.event - ERROR - Cause exception while process update id=385075250 by bot id=8399571083
OperationalError: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.user_id = ? AND vpn_keys.status = ? ORDER BY vpn_keys.created_at DESC]
[parameters: (1, 'active')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 146, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 298, in _handle_exception
    raise error
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 128, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiosqlite\core.py", line 160, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiosqlite\core.py", line 63, in _connection_worker_thread
    result = function()
             ^^^^^^^^^^
sqlite3.OperationalError: no such column: vpn_keys.server_public_key

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\status.py", line 38, in cmd_my_status
    keys = await VPNKeyDAO.get_user_keys(session, user.id, active_only=True)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\services\dao.py", line 106, in get_user_keys
    result = await session.execute(stmt)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\ext\asyncio\session.py", line 455, in execute
    result = await greenlet_spawn(
             ^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 190, in greenlet_spawn
    result = context.throw(*sys.exc_info())
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2308, in execute
    return self._execute_internal(
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2190, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\orm\context.py", line 293, in orm_execute_statement
    result = conn.execute(
             ^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1416, in execute
    return meth(
           ^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\sql\elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1639, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1848, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1988, in _exec_single_context
    self._handle_dbapi_exception(
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2343, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 1969, in _exec_single_context
    self.dialect.do_execute(
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 922, in do_execute
    cursor.execute(statement, parameters)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 146, in execute
    self._adapt_connection._handle_exception(error)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 298, in _handle_exception
    raise error
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\dialects\sqlite\aiosqlite.py", line 128, in execute
    self.await_(_cursor.execute(operation, parameters))
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 125, in await_only
    return current.driver.switch(awaitable)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\sqlalchemy\util\_concurrency_py3k.py", line 185, in greenlet_spawn
    value = await result
            ^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiosqlite\cursor.py", line 40, in execute
    await self._execute(self._cursor.execute, sql, parameters)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiosqlite\cursor.py", line 32, in _execute
    return await self._conn._execute(fn, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiosqlite\core.py", line 160, in _execute
    return await future
           ^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiosqlite\core.py", line 63, in _connection_worker_thread
    result = function()
             ^^^^^^^^^^
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.user_id = ? AND vpn_keys.status = ? ORDER BY vpn_keys.created_at DESC]
[parameters: (1, 'active')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-26 21:18:55,103 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 21:18:55,103 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 21:18:55,362 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 21:18:55,362 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 21:28:40,723 - __main__ - INFO - База данных создана
2025-12-26 21:28:47,223 - __main__ - CRITICAL - Критическая ошибка: Router is already attached to <Router '0x289835e2b90'>
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\run.py", line 73, in main
    await bot_main()
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\main.py", line 37, in main
    dp.include_router(router)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 267, in include_router
    router.parent_router = self
    ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 228, in parent_router
    raise RuntimeError(msg)
RuntimeError: Router is already attached to <Router '0x289835e2b90'>
2025-12-26 21:30:46,481 - __main__ - INFO - База данных создана
2025-12-26 21:30:51,773 - __main__ - CRITICAL - Критическая ошибка: No module named 'src.handlers.purchase'
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\main.py", line 9, in <module>
    from src.bot.loader import setup_middlewares, setup_routers
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\loader.py", line 6, in <module>
    from src.handlers import start_router, admin_router, status_router
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\__init__.py", line 3, in <module>
    from .purchase import purchase_router
ModuleNotFoundError: No module named 'src.handlers.purchase'
2025-12-26 21:34:39,483 - __main__ - INFO - База данных создана
2025-12-26 21:34:44,728 - __main__ - CRITICAL - Критическая ошибка: cannot import name 'start_router' from 'src.handlers.start' (C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\start.py)
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\main.py", line 9, in <module>
    from src.bot.loader import setup_middlewares, setup_routers
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\loader.py", line 6, in <module>
    from src.handlers import start_router, admin_router, status_router
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\__init__.py", line 1, in <module>
    from .start import start_router
ImportError: cannot import name 'start_router' from 'src.handlers.start' (C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\start.py)
2025-12-26 21:39:54,439 - __main__ - INFO - База данных создана
2025-12-26 21:39:59,652 - __main__ - CRITICAL - Критическая ошибка: cannot import name 'status_router' from 'src.handlers.status' (C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\status.py)
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\run.py", line 72, in main
    from src.main import main as bot_main
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\main.py", line 9, in <module>
    from src.bot.loader import setup_middlewares, setup_routers
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\loader.py", line 7, in <module>
    from src.handlers.start import start_router
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\__init__.py", line 3, in <module>
    from .status import status_router
ImportError: cannot import name 'status_router' from 'src.handlers.status' (C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\status.py)
2025-12-26 21:42:14,984 - __main__ - INFO - База данных создана
2025-12-26 21:42:21,767 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 21:42:21,767 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 21:42:21,767 - vpn_bot - INFO - Планировщик запущен
2025-12-26 21:42:21,768 - vpn_bot - INFO - Бот запускается...
2025-12-26 21:42:21,769 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 21:42:21,791 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.status = ? AND vpn_keys.expires_at < ?]
[parameters: ('active', '2025-12-26 21:42:21.769887')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-26 21:53:15,764 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-12-26 21:53:15,764 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 21:53:38,080 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-12-26 21:53:38,080 - aiogram.dispatcher - WARNING - Sleep for 1.430698 seconds and try again... (tryings = 1, bot id = 8399571083)
2025-12-26 21:54:00,822 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-12-26 21:54:00,823 - aiogram.dispatcher - WARNING - Sleep for 1.905211 seconds and try again... (tryings = 2, bot id = 8399571083)
2025-12-26 21:54:24,033 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-12-26 21:54:24,033 - aiogram.dispatcher - WARNING - Sleep for 2.492850 seconds and try again... (tryings = 3, bot id = 8399571083)
2025-12-26 21:54:47,842 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-12-26 21:54:47,842 - aiogram.dispatcher - WARNING - Sleep for 3.316120 seconds and try again... (tryings = 4, bot id = 8399571083)
2025-12-26 21:55:12,450 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-12-26 21:55:12,450 - aiogram.dispatcher - WARNING - Sleep for 4.327649 seconds and try again... (tryings = 5, bot id = 8399571083)
2025-12-26 22:05:04,761 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 22:05:04,762 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 22:05:05,021 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 22:05:05,021 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 22:28:45,004 - __main__ - INFO - База данных создана
2025-12-26 22:28:51,380 - __main__ - CRITICAL - Критическая ошибка: Router is already attached to <Router '0x1edfd0127d0'>
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\run.py", line 73, in main
    await bot_main()
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\main.py", line 37, in main
    dp.include_router(router)
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 267, in include_router
    router.parent_router = self
    ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 228, in parent_router
    raise RuntimeError(msg)
RuntimeError: Router is already attached to <Router '0x1edfd0127d0'>
2025-12-26 22:41:33,193 - __main__ - INFO - База данных создана
2025-12-26 22:41:42,066 - __main__ - INFO - База данных создана
2025-12-26 22:41:48,675 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 22:41:48,676 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 22:41:48,676 - vpn_bot - INFO - Планировщик запущен
2025-12-26 22:41:48,677 - vpn_bot - INFO - Бот запускается...
2025-12-26 22:41:48,677 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 22:41:48,696 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.status = ? AND vpn_keys.expires_at < ?]
[parameters: ('active', '2025-12-26 22:41:48.678780')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-26 22:44:22,913 - aiogram.event - ERROR - Cause exception while process update id=385075278 by bot id=8399571083
AttributeError: type object 'VPNKeyDAO' has no attribute 'get_user_keys'
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\status.py", line 40, in cmd_my_status
    keys = await VPNKeyDAO.get_user_keys(session, user.id, active_only=True)
                 ^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: type object 'VPNKeyDAO' has no attribute 'get_user_keys'
2025-12-26 23:11:59,776 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 23:11:59,776 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 23:12:00,039 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:12:00,039 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:12:02,399 - __main__ - INFO - База данных создана
2025-12-26 23:12:09,053 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 23:12:09,053 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:12:09,053 - vpn_bot - INFO - Планировщик запущен
2025-12-26 23:12:09,054 - vpn_bot - INFO - Бот запускается...
2025-12-26 23:12:09,055 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:12:09,074 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.status = ? AND vpn_keys.expires_at < ?]
[parameters: ('active', '2025-12-26 23:12:09.055307')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-26 23:12:16,638 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 23:12:16,638 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 23:12:16,902 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:12:16,902 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:12:45,431 - __main__ - INFO - База данных создана
2025-12-26 23:12:52,274 - vpn_bot - ERROR - Не удалось уведомить админа 625007762: Telegram server says - Bad Request: chat not found
2025-12-26 23:12:52,275 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:12:52,275 - vpn_bot - INFO - Планировщик запущен
2025-12-26 23:12:52,275 - vpn_bot - INFO - Бот запускается...
2025-12-26 23:12:52,276 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:12:52,296 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.status = ? AND vpn_keys.expires_at < ?]
[parameters: ('active', '2025-12-26 23:12:52.276607')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-26 23:13:05,279 - aiogram.event - ERROR - Cause exception while process update id=385075289 by bot id=8399571083
NameError: name 'PaymentDAO' is not defined
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 178, in process_payment_selection
    payment = await PaymentDAO.create_payment(
                    ^^^^^^^^^^
NameError: name 'PaymentDAO' is not defined
2025-12-26 23:17:21,665 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 23:17:21,666 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 23:17:21,928 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:17:21,928 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:17:24,736 - __main__ - INFO - База данных создана
2025-12-26 23:17:31,691 - vpn_bot - ERROR - Не удалось уведомить админа 625007762: Telegram server says - Bad Request: chat not found
2025-12-26 23:17:31,692 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:17:31,692 - vpn_bot - INFO - Планировщик запущен
2025-12-26 23:17:31,692 - vpn_bot - INFO - Бот запускается...
2025-12-26 23:17:31,693 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:17:31,712 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.status = ? AND vpn_keys.expires_at < ?]
[parameters: ('active', '2025-12-26 23:17:31.694714')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-26 23:17:42,640 - aiogram.event - ERROR - Cause exception while process update id=385075292 by bot id=8399571083
TypeError: PaymentDAO.create() got an unexpected keyword argument 'days'
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 179, in process_payment_selection
    payment = await PaymentDAO.create(
                    ^^^^^^^^^^^^^^^^^^
TypeError: PaymentDAO.create() got an unexpected keyword argument 'days'
2025-12-26 23:17:59,908 - aiogram.event - ERROR - Cause exception while process update id=385075298 by bot id=8399571083
TypeError: PaymentDAO.create() got an unexpected keyword argument 'days'
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\vpn_key\purchase.py", line 179, in process_payment_selection
    payment = await PaymentDAO.create(
                    ^^^^^^^^^^^^^^^^^^
TypeError: PaymentDAO.create() got an unexpected keyword argument 'days'
2025-12-26 23:23:39,857 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 23:23:39,858 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 23:23:40,115 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:23:40,115 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:28:17,421 - __main__ - INFO - База данных создана
2025-12-26 23:28:25,358 - vpn_bot - ERROR - Не удалось уведомить админа 625007762: Telegram server says - Bad Request: chat not found
2025-12-26 23:28:25,359 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:28:25,359 - vpn_bot - INFO - Планировщик запущен
2025-12-26 23:28:25,360 - vpn_bot - INFO - Бот запускается...
2025-12-26 23:28:25,361 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:28:25,383 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.status = ? AND vpn_keys.expires_at < ?]
[parameters: ('active', '2025-12-26 23:28:25.362396')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-26 23:28:52,396 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 23:28:52,396 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 23:28:52,652 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:28:52,652 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:29:16,887 - __main__ - INFO - База данных создана
2025-12-26 23:29:23,705 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 23:29:23,705 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:29:23,705 - vpn_bot - INFO - Планировщик запущен
2025-12-26 23:29:23,706 - vpn_bot - INFO - Бот запускается...
2025-12-26 23:29:23,706 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:29:23,725 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.status = ? AND vpn_keys.expires_at < ?]
[parameters: ('active', '2025-12-26 23:29:23.707516')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-26 23:43:59,480 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-26 23:43:59,480 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-26 23:43:59,734 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:43:59,734 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-26 23:59:15,128 - __main__ - INFO - База данных создана
2025-12-26 23:59:23,508 - vpn_bot - INFO - Уведомление отправлено админу 7672667340
2025-12-26 23:59:23,509 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:59:23,509 - vpn_bot - INFO - Планировщик запущен
2025-12-26 23:59:23,510 - vpn_bot - INFO - Бот запускается...
2025-12-26 23:59:23,511 - src.services.scheduler - INFO - Планировщик запущен
2025-12-26 23:59:23,536 - src.services.scheduler - ERROR - Ошибка в планировщике очистки: (sqlite3.OperationalError) no such column: vpn_keys.server_public_key
[SQL: SELECT vpn_keys.id, vpn_keys.key_name, vpn_keys.user_id, vpn_keys.private_key, vpn_keys.public_key, vpn_keys.server_public_key, vpn_keys.server_ip, vpn_keys.server_port, vpn_keys.server_endpoint, vpn_keys.ip_address, vpn_keys.config_data, vpn_keys.days, vpn_keys.created_at, vpn_keys.expires_at, vpn_keys.status, vpn_keys.payment_id 
FROM vpn_keys 
WHERE vpn_keys.status = ? AND vpn_keys.expires_at < ?]
[parameters: ('active', '2025-12-26 23:59:23.512315')]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-12-27 00:01:14,292 - aiogram.event - ERROR - Cause exception while process update id=385075323 by bot id=8399571083
ImportError: cannot import name 'PaymentDAO' from 'src.services.database' (C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\services\database.py)
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\admin\panel.py", line 66, in show_confirmations
    from src.services.database import PaymentDAO, get_session
ImportError: cannot import name 'PaymentDAO' from 'src.services.database' (C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\services\database.py)
2025-12-27 00:03:59,482 - aiogram.event - ERROR - Cause exception while process update id=385075327 by bot id=8399571083
TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
Traceback (most recent call last):
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 320, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 164, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 27, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 58, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 43, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 23, in __call__
    raise e
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\database.py", line 18, in __call__
    result = await handler(event, data)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\bot\middlewares\throttling.py", line 26, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 283, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 189, in _propagate_event
    response = await router.propagate_event(update_type=update_type, event=event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 161, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 153, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 181, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 126, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\vpn_bot\src\handlers\admin\panel.py", line 37, in back_to_main_menu
    await callback.message.edit_text(
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\client\bot.py", line 485, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\client\session\base.py", line 259, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    response = self.check_response(
               ^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\xam\PycharmProjects\vpn_bot_xam\.venv\Lib\site-packages\aiogram\client\session\base.py", line 121, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-12-27 00:04:23,807 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-12-27 00:04:23,808 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 8399571083)
2025-12-27 00:04:24,072 - src.services.scheduler - INFO - Планировщик остановлен
2025-12-27 00:04:24,072 - src.services.scheduler - INFO - Планировщик остановлен
